Для работы функции, которая берет контекст потока (вроде как) нужны права администратора. 
Контекст регулярно отказывается находиться по неизвестной причине. Подозреваю что дело в том, что в потоке вызывается
Sleep, который не дает считать контекст. 